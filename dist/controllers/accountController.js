"use strict";var path=require("path"),databasetool=require(path.join(__dirname,"../tools/databasetool.js")),captchapng=require("captchapng");exports.getLoginPage=function(e,s){s.sendFile(path.join(__dirname,"../statics/views/login.html"))},exports.getRegisterPage=function(e,s){s.sendFile(path.join(__dirname,"../statics/views/register.html"))},exports.register=function(t,a){var n={status:0,message:"注册成功"};databasetool.findOne("accountInfo",{username:t.body.username},function(e,s){s?(n.status=1,n.message="用户名已经存在",a.json(n)):databasetool.insertOne("accountInfo",t.body,function(e,s){null==s&&(n.status=2,n.message="注册失败"),a.json(n)})})},exports.getVcodeImage=function(e,s){var t=parseInt(9e3*Math.random()+1e3);e.session.vcode=t;var a=new captchapng(80,30,t);a.color(0,0,0,0),a.color(80,80,80,255);var n=a.getBase64(),o=new Buffer(n,"base64");s.writeHead(200,{"Content-Type":"image/png"}),s.end(o)},exports.login=function(e,t){var a={status:0,message:"登录成功"};if(e.body.vcode!=e.session.vcode)return a.status=1,a.message="验证码不正确",void t.json(a);databasetool.findOne("accountInfo",{username:e.body.username,password:e.body.password},function(e,s){null==s&&(a.status=2,a.message="用户名或密码错误"),t.json(a)})};